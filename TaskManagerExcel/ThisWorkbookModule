Private Sub Workbook_Open()

    Call SetShortcutKey
    Call SetFormatCondition
     
End Sub

Sub SetShortcutKey()

    Application.OnKey "^r", "InsertRowAbove"
    Application.OnKey "^+r", "InsertRowBelow"

    Application.OnKey "^h", "HideSelectedRows"
    Application.OnKey "^+h", "UnHideSelectedRows"

    Application.OnKey "^d", "ClearSelectedCells"
    Application.OnKey "^+d", "DeleteSelectedRows"
    
    
    Application.OnKey "^x", "CutSelectedRows"
    Application.OnKey "^e", "InsertSelectedRows"
    
    Application.OnKey "^q", "SetToday"
    Application.OnKey "^o", "ToggleReadOnly"
    
    Application.OnKey "^{Tab}", "NextSheet"
    Application.OnKey "^+{Tab}", "PreviousSheet"

    Application.OnKey "%1", "IndentDown"
    Application.OnKey "%2", "IndentUp"

    Application.OnKey "%3", "HideDones"
    Application.OnKey "%4", "ShowTitles"
    
End Sub

Sub SetFormatCondition()
    ThisWorkbook.ActiveSheet.Cells.FormatConditions.Delete
    With ThisWorkbook.ActiveSheet.Range("C:C")
        .FormatConditions.Add Type:=xlExpression, Formula1:="=AND($C1<>"""",$C1<=TODAY(),$D1="""")"
        .FormatConditions(.FormatConditions.Count).Interior.Color = rgbYellow
        .FormatConditions(.FormatConditions.Count).StopIfTrue = False
    End With
    With ThisWorkbook.ActiveSheet.Range("C:D")
        .FormatConditions.Add Type:=xlExpression, Formula1:="=OR(LEFT($B1,1)=""■"",LEFT($B1,1)=""・"")"
        .FormatConditions(.FormatConditions.Count).Interior.Color = rgbGainsboro
        .FormatConditions(.FormatConditions.Count).StopIfTrue = False
    End With
    With ThisWorkbook.ActiveSheet.Range("C:D")
        .FormatConditions.Add Type:=xlExpression, Formula1:="=AND($D1<>"""",$D1<>""完了日"")"
        .FormatConditions(.FormatConditions.Count).Interior.Color = rgbGainsboro
        .FormatConditions(.FormatConditions.Count).StopIfTrue = False
    End With
    With ThisWorkbook.ActiveSheet.Range("B:B")
        .FormatConditions.Add Type:=xlExpression, Formula1:="=AND($D1<>"""",$D1<>""完了日"")"
        .FormatConditions(.FormatConditions.Count).Interior.Color = rgbWhiteSmoke
        .FormatConditions(.FormatConditions.Count).StopIfTrue = False
    End With
End Sub
